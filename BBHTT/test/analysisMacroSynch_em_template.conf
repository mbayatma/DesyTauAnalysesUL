######################################################
# configuration file for SynchNTupleProducer_em_Run2
######################################################

era = 
isData =
16_pre: JSON = DesyTauAnalyses/Producer/test/json/Cert_271036-284044_13TeV_Legacy2016_Collisions16_JSON.txt
16_post: JSON = DesyTauAnalyses/Producer/test/json/Cert_271036-284044_13TeV_Legacy2016_Collisions16_JSON.txt
17: JSON = DesyTauAnalyses/Producer/test/json/Cert_294927-306462_13TeV_UL2017_Collisions17_GoldenJSON.txt
18: JSON = DesyTauAnalyses/Producer/test/json/Cert_314472-325175_13TeV_Legacy2018_Collisions18_JSON.txt
Synch = false 
ApplyMetFilters = true
ApplyPUweight =
ApplyLepSF =
ApplyTrigger = true
ApplyRecoilCorrections = false
ApplySVFit = false
ApplyMetCorrection = false
SmearMET = false
ApplyFastMTT = false
ApplyBTagScaling =
ApplyBTagReshape = 
ApplySystShift = true
splitJES = true
ApplyJetPUID = true
UsePuppiMET = true
# changed to true in make_config_Run2 for specific samples 
ApplyBTagCP5Correction = false

#### PU ####
16_pre: pileUpInDataFile = DesyTauAnalyses/Common/data/PileUpDistrib/Data_PileUp_UL2016_preVFP_69p2.root
16_post: pileUpInDataFile = DesyTauAnalyses/Common/data/PileUpDistrib/Data_PileUp_UL2016_postVFP_69p2.root
17: pileUpInDataFile = DesyTauAnalyses/Common/data/PileUpDistrib/Data_PileUp_UL2017_69p2.root
18: pileUpInDataFile = DesyTauAnalyses/Common/data/PileUpDistrib/Data_PileUp_UL2018_69p2.root
16_pre: pileUpInMCFile = DesyTauAnalyses/Common/data/PileUpDistrib/MC_PileUp_UL2016_preVFP.root
16_post: pileUpInMCFile = DesyTauAnalyses/Common/data/PileUpDistrib/MC_PileUp_UL2016_postVFP.root
17: pileUpInMCFile = DesyTauAnalyses/Common/data/PileUpDistrib/MC_PileUp_UL2017.root
18: pileUpInMCFile = DesyTauAnalyses/Common/data/PileUpDistrib/MC_PileUp_UL2018.root
16_pre: pileUpforMC = 
16_post: pileUpforMC = 
17: pileUpforMC = 
18: pileUpforMC = 

#### Corrections ####
svFitPtResFile = TauAnalysis/SVfitStandalone/data/svFitVisMassAndPtResolutionPDF.root
16_pre: QCDFileName = DesyTauAnalyses/Common/data/QCDweights_2016.root
16_post: QCDFileName = DesyTauAnalyses/Common/data/QCDweights_2016.root
17: QCDFileName = DesyTauAnalyses/Common/data/QCDweights_2017.root
18: QCDFileName = DesyTauAnalyses/Common/data/QCDweights_2018.root
16_pre: data: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2016preVFP_v2.root
16_post: data: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2016postVFP_v2.root
17: data: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2017_v2.root
18: data: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2018_v2.root
16_pre: MC: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2016preVFP_v2.root
16_post: MC: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2016postVFP_v2.root
17: MC: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2017_v2.root
18: MC: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_UL_2018_v2.root
16_pre: embedded: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_KIT/htt_scalefactors_legacy_2016.root
16_post: embedded: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_KIT/htt_scalefactors_legacy_2016.root
17: embedded: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_KIT/htt_scalefactors_legacy_2017.root
18: embedded: CorrectionWorkspaceFileName = DesyTauAnalyses/Common/data/CorrectionWS_KIT/htt_scalefactors_legacy_2018.root
16_pre: CorrectionWorkspaceFileNameEmb = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_legacy_2016.root
16_post: CorrectionWorkspaceFileNameEmb = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_legacy_2016.root
17: CorrectionWorkspaceFileNameEmb = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_legacy_2017.root
18: CorrectionWorkspaceFileNameEmb = DesyTauAnalyses/Common/data/CorrectionWS_IC/htt_scalefactors_legacy_2018.root

# ZPt reweighting
16_pre: ZptweightFile = DesyTauAnalyses/Common/data/zptm_weights_2016_kit.root
16_post: ZptweightFile = DesyTauAnalyses/Common/data/zptm_weights_2016_kit.root
17: ZptweightFile = DesyTauAnalyses/Common/data/zptm_weights_2017_kit.root
18: ZptweightFile = DesyTauAnalyses/Common/data/zptm_weights_2018_kit.root
16_pre: ZptNLOweightFile = DesyTauAnalyses/Common/data/DY_NLO_2016_pre.root
16_post: ZptNLOweightFile = DesyTauAnalyses/Common/data/DY_NLO_2016_post.root
17: ZptNLOweightFile = DesyTauAnalyses/Common/data/DY_NLO_2017.root
18: ZptNLOweightFile = DesyTauAnalyses/Common/data/DY_NLO_2018.root
ZptEmbweightFile = DesyTauAnalyses/Common/data/embed_zmm_shifts_v2.root

#### b-tag ####
16_pre: bJetEtaCut = 2.4
16_post: bJetEtaCut = 2.4
17: bJetEtaCut = 2.5
18: bJetEtaCut = 2.5
BTagAlgorithm = DeepFlavour
BTagDiscriminator1 = pfDeepFlavourJetTags:probb
BTagDiscriminator2 = pfDeepFlavourJetTags:probbb
BTagDiscriminator3 = pfDeepFlavourJetTags:problepb
16_pre: btagCut = 0.3093  
16_post: btagCut = 0.3093  
17: btagCut = 0.3033  
18: btagCut = 0.2770

# NB!
# for 2016 CP5 samples non-CP5 b-tag SF file is used, SFs get corrected in counting_jets() in leptau_jets_WIP.h
16_pre: BtagSfFile = DesyTauAnalyses/Common/data/BTagReshaping/wp_deepJet_106XUL16preVFP_v2_reformatted.csv
16_post: BtagSfFile = DesyTauAnalyses/Common/data/BTagReshaping/wp_deepJet_106XUL16postVFP_v3_reformatted.csv
17: BtagSfFile = DesyTauAnalyses/Common/data/BTagReshaping/wp_deepJet_106XUL17_v3_reformatted.csv
18: BtagSfFile = DesyTauAnalyses/Common/data/BTagReshaping/wp_deepJet_106XUL18_v2_reformatted.csv
16_pre: BTagReshapeFileName = DesyTauAnalyses/Common/data/BTagReshaping/btag_reshape_2016_pre.root
16_post: BTagReshapeFileName = DesyTauAnalyses/Common/data/BTagReshaping/btag_reshape_2016_post.root
17: BTagReshapeFileName = DesyTauAnalyses/Common/data/BTagReshaping/btag_reshape_2017.root
18: BTagReshapeFileName = DesyTauAnalyses/Common/data/BTagReshaping/btag_reshape_2018.root
16_pre: BtagMCeffFile = DesyTauAnalyses/Common/data/Eff_DeepFlavour_2016_medium_all_proc_DeepFlavour_medium_inclusive_inclusive.root
16_post: BtagMCeffFile = DesyTauAnalyses/Common/data/Eff_DeepFlavour_2016_medium_all_proc_DeepFlavour_medium_inclusive_inclusive.root
17: BtagMCeffFile = DesyTauAnalyses/Common/data/Eff_DeepFlavour_2017_medium_all_proc_DeepFlavour_medium_inclusive_inclusive.root
18: BtagMCeffFile = DesyTauAnalyses/Common/data/Eff_DeepFlavour_2018_medium_all_proc_DeepFlavour_medium_inclusive_inclusive.root

 
#### Recoil Corrections ####
16_pre: RecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PuppiMET_2016.root
16_post: RecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PuppiMET_2016.root
17: RecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PuppiMET_2017.root
18: RecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PuppiMET_2018.root
16_pre: PFMetRecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PFMET_2016.root
16_post: PFMetRecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PFMET_2016.root
17: PFMetRecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PFMET_2017.root
18: PFMetRecoilFilePath = HTT-utilities/RecoilCorrections_KIT/data/Type1_PFMET_2018.root
16_pre: RecoilSysFilePath = HTT-utilities/RecoilCorrections_KIT/data/PuppiMETSys_2016.root
16_post: RecoilSysFilePath = HTT-utilities/RecoilCorrections_KIT/data/PuppiMETSys_2016.root
17: RecoilSysFilePath = HTT-utilities/RecoilCorrections_KIT/data/PuppiMETSys_2017.root
18: RecoilSysFilePath = HTT-utilities/RecoilCorrections_KIT/data/PuppiMETSys_2018.root

#### MET filters ####
# met filters ( from https://twiki.cern.ch/twiki/bin/viewauth/CMS/MissingETOptionalFiltersRun2 )
16_pre: MC: num_met_filters = 6 # adjust accordingly
16_pre: data: num_met_filters = 7 
16_pre: embedded: num_met_filters = 7 
16_post: MC: num_met_filters = 6 # adjust accordingly
16_post: data: num_met_filters = 7 
16_post: embedded: num_met_filters = 7 
17: MC: num_met_filters = 7 
17: data: num_met_filters = 8 
17: embedded: num_met_filters = 8 
18: MC: num_met_filters = 7 
18: data: num_met_filters = 8 
18: embedded: num_met_filters = 8 
met_filter_1 = Flag_HBHENoiseFilter
met_filter_2 = Flag_HBHENoiseIsoFilter
met_filter_3 = Flag_globalSuperTightHalo2016Filter
met_filter_4 = Flag_EcalDeadCellTriggerPrimitiveFilter
met_filter_5 = Flag_goodVertices
met_filter_6 = Flag_BadPFMuonFilter
16_pre: data: met_filter_7 = Flag_eeBadScFilter
16_pre: embedded: met_filter_7 = Flag_eeBadScFilter
16_post: data: met_filter_7 = Flag_eeBadScFilter
16_post: embedded: met_filter_7 = Flag_eeBadScFilter
17: met_filter_7 = ecalBadCalibReducedMINIAODFilter
17: data: met_filter_8 = Flag_eeBadScFilter
17: embedded: met_filter_8 = Flag_eeBadScFilter  
18: met_filter_7 = ecalBadCalibReducedMINIAODFilter
18: data: met_filter_8 = Flag_eeBadScFilter
18: embedded: met_filter_8 = Flag_eeBadScFilter

#### ELECTRON ####
ptElectronLowCut = 13
ptElectronHighCut = 23
etaElectronCut = 2.4
dxyElectronCut = 0.045
dzElectronCut = 0.2
##### MUON ######
ptMuonLowCut = 13
ptMuonHighCut = 23
etaMuonCut = 2.4
dxyMuonCut = 0.045
dzMuonCut = 0.2

# e+mu triggers
LowPtLegElectron = hltMu23TrkIsoVVLEle12CaloIdLTrackIdLIsoVLElectronlegTrackIsoFilter
HighPtLegElectron = hltMu8TrkIsoVVLEle23CaloIdLTrackIdLIsoVLElectronlegTrackIsoFilter
LowPtLegMuon =  hltMu8TrkIsoVVLEle23CaloIdLTrackIdLIsoVLMuonlegL3IsoFiltered8
HighPtLegMuon = hltMu23TrkIsoVVLEle12CaloIdLTrackIdLIsoVLMuonlegL3IsoFiltered23
16_pre: ApplyDzFilterMatch = false
16_post: ApplyDzFilterMatch = false
17: ApplyDzFilterMatch = true
18: ApplyDzFilterMatch = true
Mu23Ele12DzFilter = hltMu23TrkIsoVVLEle12CaloIdLTrackIdLIsoVLDZFilter
Mu8Ele23DzFilter =  hltMu8TrkIsoVVLEle23CaloIdLTrackIdLIsoVLDZFilter

# jet resolution filenames
16_pre: JERResolutionFileName = DesyTauAnalyses/Common/data/JER/Summer20UL16APV_JRV3_MC_PtResolution_AK4PFchs.txt
16_post: JERResolutionFileName = DesyTauAnalyses/Common/data/JER/Summer20UL16_JRV3_MC_PtResolution_AK4PFchs.txt
17: JERResolutionFileName = DesyTauAnalyses/Common/data/JER/Summer19UL17_JRV2_MC_PtResolution_AK4PFchs.txt
18: JERResolutionFileName = DesyTauAnalyses/Common/data/JER/Summer19UL18_JRV2_MC_PtResolution_AK4PFchs.txt
# jet resolution SF filenames
16_pre: JERSFFileName = DesyTauAnalyses/Common/data/JER/Summer20UL16APV_JRV3_MC_SF_AK4PFchs.txt
16_post: JERSFFileName = DesyTauAnalyses/Common/data/JER/Summer20UL16_JRV3_MC_SF_AK4PFchs.txt
17: JERSFFileName = DesyTauAnalyses/Common/data/JER/Summer19UL17_JRV2_MC_SF_AK4PFchs.txt
18: JERSFFileName = DesyTauAnalyses/Common/data/JER/Summer19UL18_JRV2_MC_SF_AK4PFchs.txt
# JES uncertainties 
16_pre: JESUncertaintyFileName = DesyTauAnalyses/Common/data/JEC/RegroupedV2_Summer19UL16APV_V7_MC_UncertaintySources_AK4PFchs.txt
16_post: JESUncertaintyFileName = DesyTauAnalyses/Common/data/JEC/RegroupedV2_Summer19UL16_V7_MC_UncertaintySources_AK4PFchs.txt
17: JESUncertaintyFileName = DesyTauAnalyses/Common/data/JEC/RegroupedV2_Summer19UL17_V5_MC_UncertaintySources_AK4PFchs.txt
18: JESUncertaintyFileName = DesyTauAnalyses/Common/data/JEC/RegroupedV2_Summer19UL18_V5_MC_UncertaintySources_AK4PFchs.txt

# dR  definitions
dRleptonsCut = 0.3
dRTrigMatch = 0.5

# isolation definitions
IsMuonIsoR03 = false
IsElectronIsoR03 = true

# top pt weight parameters ( https://twiki.cern.ch/twiki/bin/viewauth/CMS/TopPtReweighting )
# numbers are taken from Danny's email dated ~20 March 2020
a_topPtWeight = 0.088   
b_topPtWeight = -0.00087
c_topPtWeight = 9.2e-07
max_pt_topPtWeight = 472.0

# extra electron veto
applyVetoElectronId = true 
ptVetoElectronCut  = 10.0
etaVetoElectronCut = 2.5
dxyVetoElectronCut = 0.045
dzVetoElectronCut  = 0.2
isoVetoElectronCut = 0.3
dRisoExtraElecVeto = 0.3
  
# extra muon veto
applyVetoMuonId = true
ptVetoMuonCut  = 10.0
etaVetoMuonCut = 2.4
dxyVetoMuonCut = 0.045
dzVetoMuonCut  = 0.2
isoVetoMuonCut = 0.3
dRisoExtraMuonVeto = 0.4

# jet cuts
JetEtaCut = 4.7
JetPtLowCut = 20.0
JetPtHighCut = 30.0
dRJetLeptonCut = 0.5

